<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="ad.size" content="width=300,height=600" />
  <title>300x600_NF_DE_Active_HVK_2025KW02_Active_HTML5</title>

  <script>
    // ====== GENERATOR VARS (werden ersetzt) ======
    var HEADLINE = "Bereit für deine Ziele?";
    var SUBLINE  = "Sport Outfits entdecken!";
    var CTA_TEXT = "Jetzt shoppen";

    // ====== THEME VARS (werden ersetzt / vom Generator injiziert) ======
    var THEME_KEY = "standard";
    var THEME_HEADLINE_COLOR = "";
    var THEME_SUBLINE_COLOR  = "";
    var THEME_CTA_ACCENT     = "";

    // ✅ IMAGE_LIST: Generator ersetzt komplett:
    // - Export: ["1.jpg","2.jpg",...]
    // - Preview: ["blob:...","blob:..."]
    var IMAGE_LIST = [
      "1.jpg",
      "2.jpg"
    ];

    // ✅ DV360 clickTag (muss global sein)
    var clickTag = "https://example.com";
    window.clickTag = clickTag;
  </script>

  <!-- ===== FONT PRELOADS ===== -->
  <link rel="preload" href="fonts/InterstateWGL-Regular.woff2" as="font" type="font/woff2" crossorigin>
  <link rel="preload" href="fonts/InterstateWGL-Bold.woff2" as="font" type="font/woff2" crossorigin>

  <style>
    html.fonts-loading #ad { opacity: 0; }
    html.fonts-loaded  #ad { opacity: 1; transition: opacity 80ms linear; }
  </style>
  <script>
    document.documentElement.classList.add("fonts-loading");
    (document.fonts ? document.fonts.ready : Promise.resolve()).then(function(){
      document.documentElement.classList.remove("fonts-loading");
      document.documentElement.classList.add("fonts-loaded");
    });
  </script>

  <style>
    *{ box-sizing:border-box; }
    html,body{ margin:0; padding:0; }

    :root{
      --w: 300px;
      --h: 600px;

      --gold: #C0A468;

      --headlineColor: #1b1b1b;
      --sublineColor:  var(--gold);
      --ctaAccent:     var(--gold);

      --topPad: 16px;
      --sidePad: 14px;
      --blockShift: -10px;

      --logoH: 40px;
      --gapLogoToHeadline: 30px;

      --hFont: 22px;
      --hLine: 1.05;

      --sFont: 18px;
      --sLine: 1.1;

      --gapHeadlineToSublineTop: 6px;
      --gapSublineToCtaBottom: 18px;
      --sublineShift: 10px;

      --ctaFont: 14px;
      --ctaPadY: 10px;
      --ctaPadX: 18px;
      --ctaRadius: 999px;

      --copyAreaMinH: 240px;
      --hoverDur: 1050ms;

      --dwellMs: 2000;
      --swipeMs: 450;

      --frameW: 1px;

      --heroBorderW: 5px;
      --heroBorderAlpha: 0.95;
      --heroBorderFalloff: 0.30;
      --heroBorderDur: 180ms;

      --restHlExtraBottom: -13px;
    }

    /* ===== WEBFONTS =====
       ✅ OPTIMIERUNG: font-display:block statt swap
       → Kein FOUT (Flash of Unstyled Text) im kurzen Banner-Zeitfenster.
    */
    @font-face{
      font-family:"InterstateWGL";
      src: url("fonts/InterstateWGL-Regular.woff2") format("woff2");
      font-weight:400;
      font-style:normal;
      font-display:block;
    }
    @font-face{
      font-family:"InterstateWGL";
      src: url("fonts/InterstateWGL-Bold.woff2") format("woff2");
      font-weight:700;
      font-style:normal;
      font-display:block;
    }

    .ad{
      width:var(--w);
      height:var(--h);
      overflow:hidden;
      background:#fff;
      font-family:"InterstateWGL", Arial, Helvetica, sans-serif;
      position:relative;
      cursor:pointer;
      display:flex;
      flex-direction:column;
      border: var(--frameW) solid var(--gold);
    }

    /* ===== REST-HIGHLIGHT ===== */
    .rest-hl{
      position:absolute;
      left:0;
      top:0;
      width:100%;
      height: var(--restHlH, 0px);
      pointer-events:none;
      opacity:0;
      transition: opacity var(--heroBorderDur) ease;
      z-index: 4;
      background:
        linear-gradient(to bottom,
          rgba(192,164,104,var(--heroBorderAlpha)) 0%,
          rgba(192,164,104,var(--heroBorderAlpha)) calc(var(--heroBorderFalloff) * 100%),
          rgba(192,164,104,0) 100%) top / 100% var(--heroBorderW) no-repeat,
        linear-gradient(to top,
          rgba(192,164,104,var(--heroBorderAlpha)) 0%,
          rgba(192,164,104,var(--heroBorderAlpha)) calc(var(--heroBorderFalloff) * 100%),
          rgba(192,164,104,0) 100%) bottom / 100% var(--heroBorderW) no-repeat,
        linear-gradient(to right,
          rgba(192,164,104,var(--heroBorderAlpha)) 0%,
          rgba(192,164,104,var(--heroBorderAlpha)) calc(var(--heroBorderFalloff) * 100%),
          rgba(192,164,104,0) 100%) left / var(--heroBorderW) 100% no-repeat,
        linear-gradient(to left,
          rgba(192,164,104,var(--heroBorderAlpha)) 0%,
          rgba(192,164,104,var(--heroBorderAlpha)) calc(var(--heroBorderFalloff) * 100%),
          rgba(192,164,104,0) 100%) right / var(--heroBorderW) 100% no-repeat;
    }

    /* ===== TOP ===== */
    .top{
      padding:var(--topPad) var(--sidePad) 0;
      background:#fff;
      display:flex;
      flex-direction:column;
      align-items:center;
      transform: translateY(var(--blockShift));
      min-height: var(--copyAreaMinH);
      justify-content: center;
      text-align:center;
      position: relative;
      z-index: 3;
    }

    .logo img{
      height:var(--logoH);
      width:auto;
      display:block;
      margin:0 auto;
    }

    .headline{
      margin: var(--gapLogoToHeadline) 0 0 0;
      font-size:var(--hFont);
      line-height:var(--hLine);
      font-weight:700;
      color: var(--headlineColor);
      max-width: 260px;
    }

    .subline{
      margin:
        calc(var(--gapHeadlineToSublineTop) + var(--sublineShift))
        0
        var(--gapSublineToCtaBottom)
        0;
      font-size:var(--sFont);
      line-height:var(--sLine);
      font-style: normal;
      font-weight:400;
      color: var(--sublineColor);
      max-width: 260px;
    }

    .cta{
      position:relative;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding: var(--ctaPadY) var(--ctaPadX);
      border-radius: var(--ctaRadius);
      font-size: var(--ctaFont);
      font-weight:700;
      text-decoration:none;
      user-select:none;
      cursor:pointer;
      background: var(--ctaAccent);
      border:2px solid transparent;
      overflow:hidden;
    }

    .cta::before{
      content:"";
      position:absolute;
      inset:0;
      width:0%;
      background:#fff;
      z-index:1;
      pointer-events:none;
      transition:none;
    }

    /* ✅ OPTIMIERUNG: will-change aus CSS entfernt.
       Wird per JS nur während Hover gesetzt → kein dauerhafter GPU-Layer. */
    .cta-inner{
      position:relative;
      z-index:2;
      line-height:1;
      white-space:nowrap;
      display:inline-block;
      color:#fff;
      transition:none;
    }

    @supports (-webkit-background-clip:text) or (background-clip:text){
      .cta-inner{
        color:transparent;
        -webkit-text-fill-color:transparent;
        -webkit-background-clip:text;
        background-clip:text;
        background-image:linear-gradient(90deg,var(--ctaAccent) 0%,var(--ctaAccent) 50%,#ffffff 50%,#ffffff 100%);
        background-size:200% 100%;
        background-position:100% 0;
      }
    }
    .cta.is-hover{ border-color: var(--ctaAccent); }
    .cta.is-hover::before{ width:100%; transition: width var(--hoverDur) linear; }
    .cta.is-hover .cta-inner{ color: var(--ctaAccent); }
    @supports (-webkit-background-clip:text) or (background-clip:text){
      .cta.is-hover .cta-inner{ background-position:0% 0; transition: background-position var(--hoverDur) linear; }
    }

    @keyframes cta-bounce{
      0%,80%,100%{ transform: translateY(0); }
      88%{ transform: translateY(-7px); }
      94%{ transform: translateY(0); }
      97%{ transform: translateY(-3px); }
    }
    .cta-bounce{ animation: cta-bounce 2s infinite; }

    /* ===== HERO =====
       ✅ OPTIMIERUNG: will-change aus CSS entfernt.
       Wird per JS nur während der Intro-Animation gesetzt. */
    .hero{
      flex: 1 1 auto;
      width:100%;
      position:relative;
      overflow:hidden;
      background:#fff;
      z-index:1;
      opacity:0;
      transform: translateY(14px);
    }

    .hero::after{
      content:"";
      position:absolute;
      inset:0;
      pointer-events:none;
      opacity:0;
      transition: opacity var(--heroBorderDur) ease;
      background:
        linear-gradient(to bottom,
          rgba(192,164,104,var(--heroBorderAlpha)) 0%,
          rgba(192,164,104,var(--heroBorderAlpha)) calc(var(--heroBorderFalloff) * 100%),
          rgba(192,164,104,0) 100%) top / 100% var(--heroBorderW) no-repeat,
        linear-gradient(to top,
          rgba(192,164,104,var(--heroBorderAlpha)) 0%,
          rgba(192,164,104,var(--heroBorderAlpha)) calc(var(--heroBorderFalloff) * 100%),
          rgba(192,164,104,0) 100%) bottom / 100% var(--heroBorderW) no-repeat,
        linear-gradient(to right,
          rgba(192,164,104,var(--heroBorderAlpha)) 0%,
          rgba(192,164,104,var(--heroBorderAlpha)) calc(var(--heroBorderFalloff) * 100%),
          rgba(192,164,104,0) 100%) left / var(--heroBorderW) 100% no-repeat,
        linear-gradient(to left,
          rgba(192,164,104,var(--heroBorderAlpha)) 0%,
          rgba(192,164,104,var(--heroBorderAlpha)) calc(var(--heroBorderFalloff) * 100%),
          rgba(192,164,104,0) 100%) right / var(--heroBorderW) 100% no-repeat;
    }

    /* ✅ OPTIMIERUNG: will-change aus CSS entfernt.
       Wird per JS nur während der Slide-Animation gesetzt. */
    .slide{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      object-fit: cover;
      object-position: center bottom;
      transform: translateX(0) scale(1.001);
    }
    #heroNext{ transform: translateX(100%) scale(1.001); }

    /* ===== Sequenz ===== */
    .seq{ opacity:0; transform:translateY(10px); }
    @keyframes fadeUp{ 0%{opacity:0;transform:translateY(10px);} 100%{opacity:1;transform:translateY(0);} }
    @keyframes heroIn{ 0%{opacity:0;transform:translateY(14px);} 100%{opacity:1;transform:translateY(0);} }

    .show-logo     { animation: fadeUp 3000ms cubic-bezier(.2,.9,.2,1) forwards; animation-delay:0ms; }
    .show-headline { animation: fadeUp 3000ms cubic-bezier(.2,.9,.2,1) forwards; animation-delay:750ms; }
    .show-subline  { animation: fadeUp 3000ms cubic-bezier(.2,.9,.2,1) forwards; animation-delay:2250ms; }
    .show-cta      { animation: fadeUp 3000ms cubic-bezier(.2,.9,.2,1) forwards; animation-delay:3000ms; }
    .show-hero     { animation: heroIn 3000ms cubic-bezier(.2,.9,.2,1) forwards; animation-delay:1500ms; }

    /* Hover-Logik */
    .ad.hover-hero .hero::after{ opacity:1; }
    .ad:hover:not(.hover-hero) .rest-hl{ opacity:1; }
  </style>
</head>

<body>
  <img
    src="https://tagm.tchibo.de/ai.aspx?extProvId=300&extProvApi=129768&extPu=tchibo-dv360&extLi=${INSERTION_ORDER_ID}&extPm=${CAMPAIGN_ID}&extCr=${CREATIVE_ID}&adslotid=${PUBLISHER_ID}&gdpr=${GDPR}&gdpr_consent=${GDPR_CONSENT_312}&cb=${CACHEBUSTER}"
    width="1" height="1" style="display:none" alt=""
  >

  <div class="ad" id="ad">
    <div class="rest-hl" id="restHl" aria-hidden="true"></div>

    <div class="top">
      <div class="logo seq show-logo">
        <img id="logoImg" src="Logo.png" alt="Logo">
      </div>
      <p class="headline seq show-headline" id="headlineEl"></p>
      <p class="subline seq show-subline" id="sublineEl"></p>
      <a class="cta seq show-cta" href="javascript:void(0)" id="cta">
        <span class="cta-inner" id="ctaInner"></span>
      </a>
    </div>

    <div class="hero show-hero" id="hero" aria-hidden="true">
      <img id="heroCurrent" class="slide" src="" alt="">
      <img id="heroNext"    class="slide" src="" alt="">
    </div>
  </div>

  <script>
    // -----------------------
    // Theme apply
    // -----------------------
    (function applyTheme(){
      var headlineColor = (typeof THEME_HEADLINE_COLOR === "string" && THEME_HEADLINE_COLOR.trim()) ? THEME_HEADLINE_COLOR.trim() : "";
      var sublineColor  = (typeof THEME_SUBLINE_COLOR  === "string" && THEME_SUBLINE_COLOR.trim())  ? THEME_SUBLINE_COLOR.trim()  : "";
      var ctaAccent     = (typeof THEME_CTA_ACCENT     === "string" && THEME_CTA_ACCENT.trim())     ? THEME_CTA_ACCENT.trim()     : "";

      if (headlineColor) document.documentElement.style.setProperty("--headlineColor", headlineColor);
      if (sublineColor)  document.documentElement.style.setProperty("--sublineColor",  sublineColor);
      if (ctaAccent)     document.documentElement.style.setProperty("--ctaAccent",     ctaAccent);
    })();

    // Texte setzen
    document.getElementById("headlineEl").textContent = HEADLINE;
    document.getElementById("sublineEl").textContent  = SUBLINE;
    document.getElementById("ctaInner").textContent   = CTA_TEXT;

    // -----------------------
    // ✅ FIX: Logo via Generator-Data-URL (src bereits ersetzt) oder
    // Fallback: resolveRootFile für ältere Preview-Umgebungen ohne Data-URL-Patch.
    // Im Export (kein <base>-Tag) ändert sich gar nichts.
    // -----------------------
    function resolveRootFile(name){
      name = String(name || "");
      if (!name) return name;
      if (/^(data:|blob:|https?:\/\/)/i.test(name)) return name;
      if (name.indexOf("../") === 0 || name.indexOf("./") === 0 || name.indexOf("/") === 0) return name;
      var baseEl   = document.querySelector("base");
      var baseHref = baseEl ? (baseEl.getAttribute("href") || "").trim() : "";
      if (baseHref && /(^|\/)assets\/?$/i.test(baseHref)) return "../" + name;
      return name;
    }

    (function fixLogo(){
      var img = document.getElementById("logoImg");
      if (!img) return;
      // Nur anpassen wenn src noch ein plain filename ist (kein Data-URL, kein Blob)
      if (/^(data:|blob:)/i.test(img.src)) return;
      img.src = resolveRootFile("Logo.png");
    })();

    // ClickTag
    function doExit(){ window.open(clickTag, "_blank"); }
    document.getElementById("ad").addEventListener("click", doExit);

    // ✅ OPTIMIERUNG: will-change nur während Hover setzen → kein dauerhafter GPU-Layer
    var cta      = document.getElementById("cta");
    var ctaInner = document.getElementById("ctaInner");
    cta.addEventListener("click",      function(e){ e.preventDefault(); e.stopPropagation(); doExit(); });
    cta.addEventListener("mouseenter", function(){
      cta.classList.add("is-hover");
      ctaInner.style.willChange = "transform, background-position";
    });
    cta.addEventListener("mouseleave", function(){
      cta.classList.remove("is-hover");
      ctaInner.style.willChange = "auto";
    });

    setTimeout(function(){ ctaInner.classList.add("cta-bounce"); }, 4200);

    // Hover-Status (Bild vs. Rest)
    var ad   = document.getElementById("ad");
    var hero = document.getElementById("hero");
    hero.addEventListener("mouseenter", function(){ ad.classList.add("hover-hero"); });
    hero.addEventListener("mouseleave", function(){ ad.classList.remove("hover-hero"); });

    // ✅ OPTIMIERUNG: will-change für Hero nur während Intro-Animation
    hero.style.willChange = "opacity, transform";
    hero.addEventListener("animationend", function(){
      hero.style.willChange = "auto";
    }, { once: true });

    // Rest-Highlight Höhe berechnen
    function readPxVar(el, name, fallback){
      var v = getComputedStyle(el).getPropertyValue(name).trim();
      var n = parseFloat(v);
      return isNaN(n) ? fallback : n;
    }
    function updateRestHighlightHeight(){
      var adRect   = ad.getBoundingClientRect();
      var heroRect = hero.getBoundingClientRect();
      var baseH    = heroRect.top - adRect.top;
      var extra    = readPxVar(document.documentElement, "--restHlExtraBottom", 0);
      var h        = Math.max(0, Math.round(baseH + extra));
      ad.style.setProperty("--restHlH", h + "px");
    }
    window.addEventListener("resize", updateRestHighlightHeight);
    setTimeout(updateRestHighlightHeight, 50);
    setTimeout(updateRestHighlightHeight, 1200);

    // ===== Slider =====
    function cssVarMs(name, fallback){
      var v = getComputedStyle(document.documentElement).getPropertyValue(name).trim();
      var n = parseFloat(v);
      return isNaN(n) ? fallback : n;
    }
    var dwellMs = cssVarMs("--dwellMs", 2000);
    var swipeMs = cssVarMs("--swipeMs", 450);

    var cur = document.getElementById("heroCurrent");
    var nxt = document.getElementById("heroNext");

    function snapNoAnim(el, x){
      el.style.transition = "none";
      el.style.transform  = "translateX(" + x + "%) scale(1.001)";
      el.offsetHeight; // reflow
    }
    function animateTo(el, x){
      el.style.transition = "transform " + swipeMs + "ms ease";
      el.style.transform  = "translateX(" + x + "%) scale(1.001)";
    }

    (function(){
      var imgs = (Array.isArray(IMAGE_LIST) && IMAGE_LIST.length) ? IMAGE_LIST.slice() : [];
      if (imgs.length === 0) return;

      imgs = imgs.map(function(s){
        s = String(s || "");
        if (/^(data:|blob:|https?:\/\/)/i.test(s)) return s;
        s = s.replace(/^(\.\/)+/, "");
        return resolveRootFile(s);
      });

      // Preload (best-effort)
      imgs.forEach(function(s){ try{ var im = new Image(); im.src = s; } catch(e){} });

      cur.src = imgs[0] || "";
      nxt.src = imgs[imgs.length > 1 ? 1 : 0] || "";

      var idx        = 0;
      var intervalId = null;

      function swipeNext(){
        if (imgs.length < 2) return;

        var nextIndex = (idx + 1) % imgs.length;
        nxt.src = imgs[nextIndex];

        snapNoAnim(nxt, 100);
        snapNoAnim(cur, 0);

        // ✅ OPTIMIERUNG: will-change nur während der Slide-Animation
        cur.style.willChange = "transform";
        nxt.style.willChange = "transform";

        requestAnimationFrame(function(){
          animateTo(cur, -100);
          animateTo(nxt,   0);
        });

        setTimeout(function(){
          // Animation fertig → GPU-Layer freigeben
          cur.style.willChange = "auto";
          nxt.style.willChange = "auto";

          idx = nextIndex;
          var tmp = cur; cur = nxt; nxt = tmp;
          snapNoAnim(nxt, 100);
        }, swipeMs);
      }

      function start(){
        if (intervalId || imgs.length < 2) return;
        intervalId = setInterval(swipeNext, dwellMs + swipeMs);
      }
      function stop(){
        if (!intervalId) return;
        clearInterval(intervalId);
        intervalId = null;
      }

      setTimeout(function(){ start(); }, 4500 + dwellMs);

      document.addEventListener("visibilitychange", function(){
        if (document.visibilityState === "hidden") stop();
        else start();
      });
    })();
  </script>
</body>
</html>
